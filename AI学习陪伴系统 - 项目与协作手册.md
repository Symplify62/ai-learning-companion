# AI学习陪伴系统 - 项目与协作手册 (Project & Collaboration Handbook)

**文档版本：** 1.1 (云端部署初步完成后更新)
**基于状态：** 迭代一核心功能完成，并已初步成功部署到云端 (Render + Vercel + OceanBase Cloud)，后端功能已验证。(截至 [请在此处填写当前日期，例如：2025年5月12日])
**核心贡献者：** Alec (项目发起人/核心用户), ADC v1.3 (前任), ADC v1.4 (现任)
**目标读者：** 项目参与者，特别是新任AI开发协调员 (ADC)

---

## 1. 引言与项目初心

### 1.1. 欢迎与项目背景
你好，新任ADC！非常欢迎你加入“AI学习陪伴系统”这个项目。

本项目旨在解决自主学习者在学习过程中可能遇到的笔记习惯不佳、难以有效沉淀和回顾知识点的问题。核心出发点是认识到"人很难改变（不良）习惯，那就（让AI）直接替这些人做笔记"。

我（Alec）怀着极大的热情和期待发起了这个项目，核心的初衷是解决个人在自主学习中遇到的笔记整理困境、知识回顾效率不高等问题。我始终认为，AI技术如果能真正帮助我们改善学习习惯、提升认知效率，那将是一件非常有价值的事情。这个项目对我而言，不仅仅是一个技术探索，更承载了我对构建一个真正实用的个人学习助手、探索人机协作学习的新模式等的思考。

### 1.2. 交接说明
本文档是项目交接的核心材料之一，旨在为新任ADC提供关于“AI学习陪伴系统”项目的宏观视角、协作方式、当前状态、未来方向以及关键的协作经验。前任ADC（v1.3及v1.4初期）在用户Alec的指导下，与编码AI（Cursor）紧密协作，已成功完成项目迭代一的核心目标，并初步实现了云端部署。

期望本文档能帮助新任ADC快速、准确地熟悉项目的当前全貌，理解关键决策、用户期望和已验证的成果，并能高效地指导用户Alec及编码AI继续推进后续迭代。

---

## 2. 项目概述与核心价值

### 2.1. 核心愿景与目标
增强“AI学习陪伴系统”，使其能够直接处理用户提供的B站视频链接，自动完成视频内容下载、音频提取、高质量语音转文字，并基于此文字稿驱动后续的AI学习笔记和知识点提示生成流程，最终辅助学习者更高效地理解、记忆和复习知识。**目前，系统已具备此核心能力，并已部署到云端，后端功能得到验证。**

### 2.2. 产品“调性”与核心用户价值 (Alec视角)
*   **产品“调性” (调性 - Product Taste):** 我期望这个产品给人的感觉是 **极致简约高效的、智能且贴心的、专业而不失易用性的**。我们追求的不是花哨的功能，而是真正能解决问题的实用价值。
*   **核心用户价值：** 对我（以及未来可能的用户）而言，这个产品最核心的价值在于 **自动化笔记生成以节省时间、高质量信息提炼以辅助理解、结构化知识呈现以便回顾**。通过云端部署，现在可以更方便地随时随地使用这些核心功能。

### 2.3. 系统概览 (云端部署初步完成后)
*   **核心功能：**
    *   支持用户通过API或已实现核心功能的前端界面提交**文本转录稿**或**B站视频URL**。
    *   通过多模块AI处理管道（Google Gemini模型，模块A.1和B的Prompt已迭代优化）自动生成：
        *   AI视频标题。
        *   高质量、优化后的文本转写稿（提供纯文本和带时间戳的结构化两种格式）。
        *   结构化的Markdown学习笔记。
        *   相关的知识点提示。
    *   结果持久化到 **OceanBase Cloud (MySQL 兼容模式)** 数据库，并通过增强的API服务提供给前端。
    *   后端实现细化的处理状态跟踪，并通过API暴露。
*   **技术栈：** Python/FastAPI (后端), React/Vite (前端), Google Gemini (AI核心), 讯飞ASR, OceanBase Cloud (DB)。
*   **部署架构：** 后端 FastAPI 应用通过 Docker 部署在 **Render**；前端 React 应用部署在 **Vercel**。

---

## 3. 当前状态与核心里程碑 (云端部署初步完成后)

**当前状态总结：** 项目已完成迭代一设定的所有核心目标，形成了一个功能可用、流程稳定、核心输出质量良好、具备基本用户界面的MVP版本。**更进一步，后端服务已成功部署到 Render 云平台，使用 OceanBase Cloud 作为数据库，并通过 API 测试验证了核心功能的云端可用性。** B站视频到AI笔记的核心处理流程已完全打通，并在云端环境中得到初步验证。关键技术风险（如讯飞API交互、长时间任务的数据库连接稳定性、AI输出质量控制、云端部署配置）已得到有效解决和显著改善。

**核心里程碑（截至云端部署初步完成后）：**

1.  **完整的B站视频到AI内容生成流程已打通并稳定运行 (本地与云端初步验证)。**
2.  **后端服务健壮性显著提升** (数据库会话管理重构，详细状态管理)。
3.  **ASR服务成功解耦** (引入抽象接口与工厂模式)。
4.  **核心AI模块输出质量迭代优化** (模块A.1 Prompt v1.4, 模块B Prompt v1.3)。
5.  **API功能增强与规范化** (POST接口健壮性，GET /status 返回更丰富结果)。
6.  **前端核心交互与数据显示闭环** (URL提交 -> 状态轮询 -> 完整结果展示 - *前端云端部署待完成*)。
7.  **关键Bug修复** (AttributeError, NameError等)。
8.  **成功实现后端应用的 Docker 化并通过 Render 平台部署到云端。**
9.  **成功将数据库迁移并配置为使用 OceanBase Cloud (MySQL 兼容模式)。**
10. **通过系统性的调试，解决了云端部署中的依赖、配置、数据库连接和模型兼容性等一系列问题。**

---

## 4. 未来规划与迭代方向

### 4.1. 已知取舍与待改进 (云端部署初步完成后)

迭代一及初步云端部署成功地构建了核心功能闭环，但也存在一些为了效率和聚焦目标而做出的取舍，以及识别出的待改进点：

*   **AI核心模块输出质量相关 (高层视角):**
    *   **模块A.1 (转录预处理 - Prompt v1.4):**
        *   *待改进:* 轻微文本重复偶现；特定复杂标点稳定性；对复杂ASR错误的修正能力有限。
        *   *已达成:* 解决内部不自然换行；基本中文标点改善；忠实度与流畅性达标。
    *   **模块B (笔记生成 - Prompt v1.3):**
        *   *待改进:* 笔记结构相对固定（模板化），对不同内容普适性待观察；时间戳关联精度有限。
        *   *已达成:* 去除顶层H1；语言一致性保证；元数据输出稳定；结构清晰满足目标。
*   **前端用户体验 (UX/UI) 相关 (明确优化重点):**
    *   *待改进:* 整体视觉风格基础；结果垂直堆叠需滚动；状态文本可更友好；加载过渡可更平滑；缺少便捷交互（复制、折叠等）；错误提示和空状态处理可优化。**前端云端部署 (Vercel) 待完成并进行端到端测试。**
    *   *已达成:* 核心交互流程完整；关键内容清晰展示；基本UI文本优化。
*   **后端架构与技术实现相关 (技术债与优化点):**
    *   *待改进:* `app/services/orchestration.py` 文件较大，可维护性待提升（计划后续拆分）；缺乏自动化测试覆盖。
    *   *已达成:* 核心数据库稳定性问题解决；细化状态管理实现；ASR服务解耦；**后端成功 Docker 化并部署到 Render。**
*   **数据库相关 (OceanBase Cloud):**
    *   *待改进:*
        *   **白名单配置：** 当前 OceanBase Cloud 的 `ob_tcp_invited_nodes` 为 `%` (允许所有 IP)，出于安全考虑，未来应研究配置更严格的 IP 范围或 Render 服务的静态出口 IP (如果可用)。
        *   **SSL/TLS 连接：** 当前连接 OceanBase Cloud 未显式配置 SSL 参数，依赖默认行为。未来应研究并配置强制的、安全的 SSL/TLS 连接参数，可能涉及证书管理。
        *   **数据库迁移工具：** 当前 `app/main.py` 中的 `on_startup` 自动建表逻辑适用于开发和初始部署，未来更成熟的模式应引入数据库迁移工具 (如 Alembic) 管理数据库模式的演进。
    *   *已达成:* **成功在 Render 上连接并使用 OceanBase Cloud (MySQL 兼容模式) 存储数据。**
*   **配置与环境:**
    *   *待改进:* 前端API Base URL依赖部署时正确设置环境变量 (Vercel 部署时需配置)。
    *   *已达成:* 前端不再硬编码API URL。后端通过 Render 环境变量管理配置。

### 4.2. 后续明确的开发步骤与任务 (迭代二及以后规划)

1.  **迭代二：初步个性化与分享准备 (Should Have)**
    *   **完成云端部署与端到端验证 (首要)：**
        *   **C1 & C2 (续): 部署前端到 Vercel**，配置 `VITE_API_BASE_URL` 指向 Render 后端。
        *   进行完整的端到端测试，确保云端服务流程通畅。
    *   **功能增强：**
        *   **E1: 用户输入与引导增强：** 允许用户提交时提供学习目标/重点 (影响模块 B Prompt)。
        *   **E2: 笔记编辑功能 (基础版)：** 允许用户编辑和保存AI笔记 (涉及新的 API 端点和前端修改)。
    *   **前端UX优化初步：**
        *   **分栏显示：** 尝试转写稿与笔记左右分栏。
        *   **状态文本优化：** 提升友好度。
    *   **后端与数据库优化初步：**
        *   研究并实施更安全的 OceanBase Cloud 白名单配置。
        *   研究 OceanBase Cloud 的 SSL/TLS 连接最佳实践，并尝试在 `DATABASE_URL` 中配置。

2.  **迭代三及以后：深度优化与拓展 (Could Have & Ongoing)**
    *   **用户体验深度优化：** 专业UI/交互、时间戳联动、便捷功能、响应式设计。
    *   **技术架构持续优化：** `orchestration.py` 拆分、任务队列评估、LLM成本优化、引入 Alembic 进行数据库迁移管理。
    *   **功能拓展：** 更多输入源、智能问答、个性化学习路径等。
    *   **AI能力持续提升：** Prompt迭代、ASR后处理研究。
    *   **运维与监控：** 完善云端体系，日志聚合与监控。

3.  **（持续）错误处理、日志记录、可测试性、可维护性。**

### 4.3. 个人展望 (Alec视角)
*   短期关注：**让朋友能通过云端 URL 稳定使用核心功能**、笔记的在线编辑功能、前端界面的视觉和交互体验大幅提升。
*   长远梦想：成为一个高度智能和个性化的终身学习伴侣、能够处理多种类型的学习资料、具备真正的对话式学习辅导能力。

---

## 5. 协作模式与指南

### 5.1. 与用户 (Alec) 的协作偏好与期望
*   **协作方式偏好：**
    *   欣赏ADC能够清晰地解释技术方案、引导产品思考、在反馈后快速调整策略。
    *   希望未来能继续或加强：更主动地提出优化建议、对AI（Cursor）能力边界有更清晰预判、更频繁地进行小步验证。
*   **沟通偏好：**
    *   倾向于 **先看到整体方案再讨论细节**。
    *   提出“发散”或“挑战性”问题（如“如何思考如何思考”）时，是希望激发更深层次讨论和洞察，期待ADC展现“战略产品架构师”的思考能力。
    *   对AI（Cursor/LLM）输出 **非常关注细节和准确性**，特别是内容生成方面。
*   **对新任ADC的期望：**
    *   快速熟悉项目（包括已部署的云端架构）。
    *   延续并优化协作模式（结合v1.4特性）。
    *   关注用户体验，从用户角度思考。
    *   **勇于提出见解**，扮演“战略产品架构师”角色，主动发现问题、提出方案、甚至挑战固有想法（需有充分理由）。
    *   管理好与Cursor的协作，设计有效指令，引导关键验证，**特别是在涉及多文件修改、云端配置和复杂调试时，需要有条理地分解任务并与 Cursor 清晰沟通。**
    *   **具备一定的云部署和数据库知识**，能够协助排查类似本次部署中遇到的连接、配置和兼容性问题。

### 5.2. 与AI (Cursor & LLM) 协作的最佳实践与避坑指南 (核心经验 - 已扩充)

#### 5.2.1. 与编码AI（特指Cursor）的协作经验

*   **`edit_file` 工具的核心使用与注意事项:**
    *   **精确指令与上下文至关重要：** 明确文件/函数/行号，修改前获取上下文 (`read_file` 或提供片段)。避免模糊指令。
    *   **处理大型文件或复杂修改（高风险区 - 关键避坑策略）：**
        *   *遇到的坑:* `edit_file` 对大型/复杂修改的准确性和成功率下降，易损坏文件。
        *   *有效模式（“小步快跑，频繁验证”）：*
            1.  **人工分解：** ADC+USER 将复杂任务分解为小修改点。
            2.  **逐点指令：** 针对每个点给清晰、局部指令。
            3.  **严格验证 (CRITICAL):** ADC **必须引导USER通过IDE直接检查实际文件内容**，不能仅依赖Cursor报告。可用 `read_file` 交叉验证。
            4.  **逐步迭代：** 确认无误后再进行下一步。
        *   *有效模式（人工主导，AI辅助片段）：* USER主导修改，让Cursor生成特定代码片段供复制粘贴适配。
    *   **处理特殊字符与字符串转义：**
        *   *遇到的坑:* `edit_file` 处理含转义字符的字符串（尤其Prompt）时易出错。
        *   *有效模式:* 若AI反复出错，**USER手动在IDE中编辑最可靠**。ADC需识别并建议。
    *   **`edit_file`报告“无变化”的处理：**
        *   *遇到的坑:* 报告“no changes”但实际内容不符或未修改。
        *   *有效模式:* 不能轻信。引导USER直接检查文件或用 `read_file` 获取实况。若多次无效，反思指令或工具能力。
    *   **多文件修改的协调：** 当需要修改多个相互关联的文件时（如修改 `config.py`, `database.py`, `models.py` 以适配新的数据库连接方式），需要ADC清晰规划修改顺序和内容，分步指导 Cursor，并在每一步后进行验证。

*   **`run_terminal_cmd` 工具的使用:**
    *   用于 `curl` 测试API有效。
    *   **用于执行 Git 命令 (如 `git add`, `git commit`, `git push`)：**
        *   *经验：* Cursor 可以成功执行这些命令，但需要用户明确授权。
        *   *注意事项：* ADC 需要提供非常精确的命令序列。如果 Git 操作需要认证（如首次推送到新仓库或 PAT 过期），Cursor 可能无法处理，需要用户手动在终端完成。如果暂存区状态复杂（如我们遇到的部分文件未暂存），Cursor 可能需要额外指导（如使用 `git add .`）。
    *   注意其执行环境与USER本地环境差异。

*   **`read_file` 工具的使用:**
    *   获取上下文的好习惯。
    *   辅助验证修改（最终需IDE确认）。
    *   对大文件有局限性。

*   **管理Cursor的“上下文记忆”:**
    *   *遇到的坑:* 多轮对话中“忘记”早期信息或指令细节。
    *   *有效模式:* ADC主动提醒上下文；提供精确引用；结构化长指令；在复杂任务中，将一个大指令分解为多个小指令，逐步完成。

*   **处理Cursor的“过度自信”或“理解偏差”:**
    *   *遇到的坑:* 声称完成但有遗漏/偏差，或按自己理解执行（如将 `print` 语句加到 `Dockerfile` 而非 `.py` 文件）。
    *   *有效模式:* **永不假设，永远验证 (ADC核心职责)**；精确反馈错误点与期望；简化或重构指令；要求 Cursor 在执行敏感操作（如修改多个文件、执行终端命令）前，先复述计划或展示将要做的修改。

*   **系统级调试与AI协作：**
    *   当遇到复杂的部署或运行时问题（如我们经历的云端部署调试），AI（Cursor）主要扮演**执行者**的角色（修改代码、执行命令）。
    *   ADC 和 USER 需要主导**分析和决策**过程（分析日志、判断问题根源、制定调试策略、设计测试方案）。
    *   可以将调试任务分解为小块，让 Cursor 执行具体的代码修改（如添加日志、修改配置、创建调试脚本）或命令。
    *   **迭代是关键：** 分析结果 -> 调整策略 -> 指导 Cursor -> 再次验证。

#### 5.2.2. 与内容生成LLM（通过System Prompt指导）的协作经验

*   **Prompt工程的核心原则:**
    *   清晰、明确、无歧义。
    *   结构化指令（标题、编号、列表、示例）。
    *   角色扮演。
    *   **多重强调关键约束** (重要指令在多处用不同措辞反复强调)。
    *   正反示例。

*   **迭代优化是常态:**
    *   接受没有完美的初始Prompt。
    *   小步快跑，针对性调整。
    *   **记录版本与变更理由** (如Prompt内注释v1.1, v1.2)。

*   **处理LLM的“不完全遵循”:**
    *   *遇到的坑:* 遗漏JSON字段；细节执行偏差；多重约束下的“选择性遗忘”。
    *   *有效模式:*
        *   **强化Prompt约束强度和明确性** (MUST, CRITICAL, ABSOLUTELY)。
        *   简化输出要求（权衡）。
        *   **Python端的严格校验与日志** (在`module_*_llm_caller.py`中校验LLM响应JSON，记录原始输出)。
        *   **接受LLM的能力边界** (对细微瑕疵在达到核心价值后可接受基线)。

*   **语言与文化相关的细微之处:**
    *   中文标点需明确指令/示例。
    *   “调性”需在Prompt中清晰描述。

### 5.3. 通用协作原则
*   **文档驱动：** 保持核心文档（如本手册、技术参考、System Prompts）及时更新，作为“单一事实来源”和“集体记忆”。**本次云端部署的经验应及时补充到相关文档中。**
*   **频繁沟通与确认：** ADC需与USER（Alec）就计划、AI输出、问题、策略进行频繁、透明的沟通和确认。
*   **耐心与实验精神：** AI辅助开发是探索过程，尤其在云端部署和复杂调试时，需要系统分析、策略尝试、从经验中学习。
*   **明确分工，各司其职：** USER（愿景、需求、决策、评估、平台操作），ADC（战略、规划、协调、AI指令、技术分析、日志解读），CODING AI（执行代码生成/修改、命令执行）。

---

## 6. ADC角色与思考建议 (融入ADC角色)

### 6.1. 理解和对齐“战略产品架构师”角色
*   超越技术实现，从产品愿景、用户价值出发。
*   在面对AI输出不完美或部署挑战时，判断是继续投入优化，还是接受“足够好”基线，或调整策略（如临时切换数据库验证），优先保障核心流程和价值闭环。

### 6.2. “如何更好地思考”的建议
1.  **始终从“用户价值”和“产品目标”出发。**
2.  **结构化问题，系统性分析：** 面对复杂问题（如部署失败），从日志、配置、代码、环境等多个维度系统排查。
3.  **预研与多方案评估（风险驱动）：** 对AI能力边界、云平台特性、数据库兼容性等进行预研或小范围测试验证。
4.  **预见依赖与环境问题：** 考虑本地与云端环境的差异，依赖库的兼容性。
5.  **迭代与循序渐进，拥抱不完美，快速验证：** 先让核心可用（如本地MVP），再逐步完善和部署（如云端调试），在遇到障碍时灵活调整。
6.  **保持批判性思维和主动验证（对AI和对自己）：** 对AI输出保持审视，当AI反复出错或部署反复失败时，主动调整策略（切换指令、修改测试方案、人工介入）。
7.  **积极沟通，明确分工，灵活调整：** 当原计划遇AI瓶颈或技术难题时，及时与用户沟通，共同商议调整方案。

---

## 7. 交接说明与结语

本手册旨在为新任ADC提供一个全面的项目概览、协作框架和未来方向。通过理解项目的初心、现状（包括已初步完成的云端部署）、规划以及与人、与AI协作的经验教训（特别是本次云端部署调试的宝贵经验），相信新任ADC能够快速融入项目，并带领“AI学习陪伴系统”走向新的成功。

**祝您工作顺利！**